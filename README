Port of robothaxe utility StateMachine originally created by Joel Hooks.